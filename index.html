<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gravity of Joy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: sans-serif; }
        #ui { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); text-align: center; width: 100%; z-index: 10; }
        button { background: #e94560; border: none; padding: 15px 30px; color: white; border-radius: 50px; font-size: 18px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #permission-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 26, 46, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; padding: 20px; text-align: center; }
    </style>
</head>
<body>

    <div id="permission-overlay">
        <h2>Welcome to the Gravity of Joy</h2>
        <p>This app uses your phone's tilt sensors to move your "Joy Marbles."</p>
        <button onclick="requestAccess()">Start Experience</button>
    </div>

    <div id="ui">
        <button onclick="addJoy()">+ Add a Joy</button>
    </div>

    <script>
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Events } = Matter;
        const engine = Engine.create();
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
        });

        // Walls
        const wallOptions = { isStatic: true, render: { visible: false } };
        const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight + 50, window.innerWidth, 100, wallOptions);
        const ceiling = Bodies.rectangle(window.innerWidth/2, -50, window.innerWidth, 100, wallOptions);
        const leftWall = Bodies.rectangle(-50, window.innerHeight/2, 100, window.innerHeight, wallOptions);
        const rightWall = Bodies.rectangle(window.innerWidth + 50, window.innerHeight/2, 100, window.innerHeight, wallOptions);
        Composite.add(engine.world, [ground, ceiling, leftWall, rightWall]);

        function addJoy() {
            const joys = ["‚ú®", "üåà", "‚ù§Ô∏è", "üçï", "‚òÄÔ∏è", "üéâ", "üî•", "ü¶Ñ"];
            const joy = joys[Math.floor(Math.random() * joys.length)];
            const circle = Bodies.circle(window.innerWidth/2, 100, 30, {
                restitution: 0.8,
                friction: 0.1,
                render: { 
                    sprite: { 
                        texture: `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60"><text x="10" y="45" font-size="40">${joy}</text></svg>` 
                    } 
                }
            });
            Composite.add(engine.world, circle);
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function requestAccess() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(state => { if (state === 'granted') initSensor(); })
                    .catch(console.error);
            } else { initSensor(); }
            document.getElementById('permission-overlay').style.display = 'none';
        }

        function initSensor() {
            window.addEventListener('deviceorientation', (event) => {
                let gravityX = event.gamma / 45; // Tilt left/right
                let gravityY = event.beta / 45;  // Tilt forward/back
                engine.gravity.x = gravityX;
                engine.gravity.y = gravityY;
            });
        }

        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);
    </script>
</body>
</html>
