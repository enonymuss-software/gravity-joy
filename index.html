<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gravity of Joy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        #ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); text-align: center; width: 100%; z-index: 10; pointer-events: none; }
        button { pointer-events: auto; background: #e94560; border: none; padding: 18px 35px; color: white; border-radius: 50px; font-size: 20px; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.4); active { transform: scale(0.95); } transition: transform 0.1s; }
        #permission-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #16213e; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; padding: 30px; text-align: center; }
        .instruction { color: #95a5a6; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="permission-overlay">
        <h1 style="margin-bottom:10px;">Gravity of Joy</h1>
        <p>Tilt to roll. Shake to clear.</p>
        <button onclick="requestAccess()">Enter Space</button>
    </div>

    <div id="ui">
        <button onclick="addJoy()">‚ú® Add a Joy</button>
        <div class="instruction">Tilt your phone to move them!</div>
    </div>

    <script>
        const { Engine, Render, Runner, Bodies, Composite } = Matter;
        const engine = Engine.create();
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
        });

        // Jar Boundaries
        const wallOptions = { isStatic: true, render: { visible: false } };
        let ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight + 50, window.innerWidth, 100, wallOptions);
        let ceiling = Bodies.rectangle(window.innerWidth/2, -50, window.innerWidth, 100, wallOptions);
        let leftWall = Bodies.rectangle(-50, window.innerHeight/2, 100, window.innerHeight, wallOptions);
        let rightWall = Bodies.rectangle(window.innerWidth + 50, window.innerHeight/2, 100, window.innerHeight, wallOptions);
        Composite.add(engine.world, [ground, ceiling, leftWall, rightWall]);

        function addJoy() {
            // EDIT YOUR EMOJIS HERE:
            const joys = ["‚òï", "ü•ê", "üïØÔ∏è", "üìö", "üß∏", "‚ú®", "‚ù§Ô∏è"]; 
            const joy = joys[Math.floor(Math.random() * joys.length)];
            
            const circle = Bodies.circle(window.innerWidth/2, 50, 35, {
                restitution: 0.7,
                friction: 0.05,
                render: { 
                    sprite: { 
                        texture: `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><text x="15" y="55" font-size="50">${joy}</text></svg>` 
                    } 
                }
            });
            Composite.add(engine.world, circle);
            if (navigator.vibrate) navigator.vibrate(40);
        }

        function clearJoys() {
            const allBodies = Composite.allBodies(engine.world);
            allBodies.forEach(body => {
                if (!body.isStatic) {
                    Matter.Body.applyForce(body, body.position, { 
                        x: (Math.random() - 0.5) * 0.5, 
                        y: -0.5 
                    });
                    setTimeout(() => Composite.remove(engine.world, body), 300);
                }
            });
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
        }

        let lastX, lastY, lastZ;
        function initSensor() {
            // TILT LOGIC
            window.addEventListener('deviceorientation', (event) => {
                engine.gravity.x = event.gamma / 30;
                engine.gravity.y = event.beta / 30;
            });

            // SHAKE LOGIC
            window.addEventListener('devicemotion', (event) => {
                let acc = event.acceleration;
                if (!acc.x) return;
                
                let speed = Math.abs(acc.x + acc.y + acc.z);
                if (speed > 25) { // Sensitivity threshold
                    clearJoys();
                }
            });
        }

        function requestAccess() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(state => { if (state === 'granted') initSensor(); })
                    .catch(console.error);
            } else { initSensor(); }
            document.getElementById('permission-overlay').style.display = 'none';
        }

        Render.run(render);
        Runner.run(Runner.create(), engine);
    </script>
</body>
</html>
